"0","plot_pie_2 <- function(data, column, legend.label = quo(column), groupname){"
"0","  ###This function requires the following packages: dplyr, ggplot2 and plotly."
"0","  "
"0","  ## enquo captures expressions that you supply, in this case the column name."
"0","  column <- enquo(column)"
"0","  groupname <- enquo(groupname)"
"0","  "
"0","  m <- list(l = 50, r = 50, b = 75, t = 75, pad = 6)"
"0","  "
"0","  data2 <- data %>% "
"0","    ##!! unquotes"
"0","    group_by(!!column, !!groupname) %>% "
"0","    count() %>%"
"0","    ungroup() %>% "
"0","    mutate(percent=ceiling(100*(`n`/sum(`n`)))) %>%"
"0","    group_by(!!groupname, add = T) %>% "
"0","    #    mutate(group_percent = paste0(ceiling(100*count/count, 2), ""%"")) %>% "
"0","    mutate(group_percent = ceiling(`n`/sum(`n`)*100)) %>% "
"0","    ungroup() %>% "
"0","    #    mutate(percent_nongermmulti = ceiling(100*(`n`/sum(`n`))) if {!!groupname == ""NonGermMulti""}) %>% "
"0","    mutate(column := as.factor(!!column)) %>% "
"0","    mutate(groupname := as.factor(!!groupname)) %>% "
"0","    select(column, group_percent, percent, `n`, groupname)"
"0",""
"0","  "
"0","  p <- plot_ly(data = data2, values=~percent, type = ""pie"", visible = T, showlegend = F, textinfo = ""label"", hoverinfo = ""text"", labels = ~paste(column, ""</br></br></br>"", percent, ""%""), text = ~paste(column, ""</br></br>"", groupname, ""</br>"", percent, ""%"")) %>% "
"0","    add_trace(data = subset(data2, groupname == ""NonGermMulti""), labels = ~paste(column), values = ~group_percent, visible = F, hoverinfo = ""text"", text = ~paste(column, ""</br></br>"", group_percent, ""%"")) %>%"
"0","    add_trace(data = subset(data2, groupname == ""NonGermAnglo""), labels = ~paste(column), values = ~group_percent, visible = F, hoverinfo = ""text"", text = ~paste(column, ""</br></br>"", group_percent, ""%"")) %>%"
"0","    add_trace(data = subset(data2, groupname == ""German""), labels = ~paste(column), values = ~group_percent, visible = F, hoverinfo = ""text"", text = ~paste(column, ""</br></br>"", group_percent, ""%"")) %>%"
"0","    add_trace(data = subset(data2, groupname == ""English""), labels = ~paste(column), values = ~group_percent, visible = F, hoverinfo = ""text"", text = ~paste(column, ""</br></br>"", group_percent, ""%"")) %>%"
"0","    add_trace(data = subset(data2, groupname == ""EnglishMulti""), labels = ~paste(column), values = ~group_percent, visible = F, hoverinfo = ""text"", text = ~paste(column, ""</br></br>"", group_percent, ""%"")) %>%"
"0","    "
"0","    layout(autosize = F, margin = m) %>% "
"0","    "
"0","    layout(title = legend.label,"
"0","           updatemenus = list("
"0","             list("
"0","               type = 'dropdown',"
"0","               active = 0,"
"0","               buttons = list("
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(TRUE, FALSE, FALSE, FALSE, FALSE, FALSE)),"
"0","                      label = ""All""),"
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(FALSE, TRUE, FALSE, FALSE, FALSE, FALSE)),"
"0","                      label = ""NonGermMulti""),"
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(FALSE, FALSE, TRUE, FALSE, FALSE, FALSE)),"
"0","                      label = ""NonGermAnglo""),"
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(FALSE, FALSE, FALSE, TRUE, FALSE, FALSE)),"
"0","                      label = ""German""),"
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(FALSE, FALSE, FALSE, FALSE, TRUE, FALSE)),"
"0","                      label = ""English""), "
"0","                 list(method = ""restyle"","
"0","                      args = list(""visible"", list(FALSE, FALSE, FALSE, FALSE, FALSE, TRUE)),"
"0","                      label = ""EnglishMulti"")))))"
"0","  p"
"0","  "
"0","}"
