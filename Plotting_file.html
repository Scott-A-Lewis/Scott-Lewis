<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Functions for plotting</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Scott Lewis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="&lt;ion &lt;ion-icon name=&quot;cellular-outline&quot;&gt;&lt;/ion-icon&gt;"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Plotting_file.html">Barplots</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Functions for plotting</h1>

</div>


<style type="text/css">
h1, h2, h3 {text-align: center;}
h1  {color:#FFFAF0;
    background-color: #708090; 
    padding: 20px;
    font-weight:bold;}
h4 {background-color: #A52A2A;
    color:#FFFAF0;
    padding: 12px}
</style>
<p>
The following function was designed to create barplots and save them automatically.
</p>
<p>
It was developed for a project that required the creation of a large number of barplots, each of which needed the x-axis label to be changed. Having the function rapidly reduced the time needed to do this.
</p>
<p>
I was working with multiple dataframes. Within each of these dataframes were a large number of columns that needed to be plotted. These had unfriendly names and so I wanted to relabel them for plotting purposes.
</p>
<p>
I also wanted to ensure that percentage labels occured above bars in each plot. This was done for ease of readibility, as the plots were designed for lay readers.
</p>
<p>
To that end, within the function, the user is asked to provide three arguments:
</p>
<ul>
<li>
‘data’ is a dataframe.
</li>
<li>
‘column’ is the name of any column in the dataframe.
</li>
<li>
‘legend.label’ is an optional argument. If the user wants to rename the column for plotting purposes, they need to specify the name in quotation marks, writing, for example <em>legend.label = “New Name”</em>. If this is not done, then the column name from the dataframe will be used to label the x-axis title (with nothing being renamed). <strong>In each case, the dataframe itself is not changed</strong>. The function <em>only</em> creates a graph and does not alter the original data.
</li>
<p>
<p><strong>A quick note: dplyr and ggplot2 packages must be loaded for this function to work.</strong>The packages can be loaded by typing</p>
<pre><code>library(dplyr)
library(ggplot2)</code></pre>
</p>
<pre><code>plot_column &lt;- function(data, column, legend.label = quo(column)){
  
  ###This function requires the following packages: dplyr and ggplot2.
  
  ##deparse(substitute(data)) is used to convert the name of the data into a string
  ##This helps construct the filename to save the image later.
  data_name &lt;- deparse(substitute(data))
  
  ## enquo captures expressions that you supply, in this case the column name.
  column &lt;- enquo(column)
  
  ##dplyr is used to find percentages to plot on the y-axis 
  data2 &lt;- data %&gt;% 
    ##!! unquotes
    group_by(!!column) %&gt;% 
    count() %&gt;% 
    ungroup() %&gt;% 
    
    ##Ceiling is used below to round up. I didn&#39;t want to include decimal places. If you don&#39;t want to do this, delete the word &#39;ceiling&#39; and remove the corresponding set of brackets to the right, so the line below instead reads: mutate(percent=100*(`n`/sum(`n`))) %&gt;%   
    
    mutate(percent=ceiling(100*(`n`/sum(`n`)))) %&gt;%
    mutate(!!column := as.factor(!!column)) %&gt;% 

  print(data2)
  ##Prints the updated data, including count and percentage
  
  ##Plotting is done with the code below
  plot &lt;- ggplot(data2, aes(x = !!column, fill = !!column)) + geom_col(aes(y = percent)) + 
    theme_classic() + theme(legend.position = &quot;none&quot;) + xlab(legend.label) + ylab(&quot;Percent&quot;) + 
    geom_text(aes(label = paste0(percent, &quot;%&quot;), y = percent), vjust = -0.5)
    
  ##ggsave is used to save the file. The code below takes the name of the data and the legend label. 
  #It adds _bar and saves it as a .png file.
  ggsave(paste0(data_name, legend.label, &quot;_bar&quot;, &quot;.png&quot;, sep=&quot;&quot;), plot, device = &quot;png&quot;)
  
  #The plot is then displayed in the console
  plot
}
</code></pre>
<div id="running-the-function" class="section level3">
<h3>Running the Function</h3>
<p>
In order to see how the function works, let’s first create an example dataframe. This dataframe, imaginatively called <em>fake_data</em> has just two columns, but we’ll focus on the first here. The column name “X.1.What.Is.Your.Age” is an example of the sort of ugly column name that can result when complicated heading names are read into R. Within the column are example results.
</p>
<pre class="r"><code>fake_data &lt;- data.frame(&quot;X.1.What.Is.Your.Age?&quot; = c(&quot;26-30&quot;, &quot;26-30&quot;, &quot;26-30&quot;, &quot;31-35&quot;, &quot;31-35&quot;, &quot;36-40&quot;, &quot;36-40&quot;, &quot;36-40&quot;, &quot;41-45&quot;, &quot;46-50&quot;), &quot;X.2.What.Is.Your.Occupation?&quot; = c(&quot;Magician&quot;, &quot;Swamp Monster&quot;, &quot;Magician&quot;, &quot;Magician&quot;, &quot;Doctor&quot;, &quot;Doctor&quot;, &quot;Accountant&quot;, &quot;Accountant&quot;, &quot;Magician&quot;, &quot;Cleaner&quot;))  </code></pre>
<p>
The dataframe looks like this:
</p>
<pre class="r"><code>print(fake_data)</code></pre>
<pre><code>##    X.1.What.Is.Your.Age. X.2.What.Is.Your.Occupation.
## 1                  26-30                     Magician
## 2                  26-30                Swamp Monster
## 3                  26-30                     Magician
## 4                  31-35                     Magician
## 5                  31-35                       Doctor
## 6                  36-40                       Doctor
## 7                  36-40                   Accountant
## 8                  36-40                   Accountant
## 9                  41-45                     Magician
## 10                 46-50                      Cleaner</code></pre>
<p>
Now to use the function. Having pasted the function into the r console, I can call it using plot_column. I need to specify the arguments (data, column and, optionally, legend.label). I want to plot the first column, which is about the participants’ age groups. The name ‘X.1.What.Is.Your.Age.’ might not make for the prettiest of x-axis label, so I want to change this to ‘Age’. Therefore, I’m going to use the optional argument <em>legend.label</em>.
</p>
<p>
To plot the column of interest, I call: plot_column(fake_data, column = X.1.What.Is.Your.Age., legend.label = “Age”).
</p>
<p>
The results of doing so are plotted below:
</p>
<pre class="r"><code>plot_column(fake_data, column = X.1.What.Is.Your.Age., legend.label = &quot;Age&quot;)</code></pre>
<pre><code>## # A tibble: 5 x 3
##   X.1.What.Is.Your.Age.     n percent
##   &lt;fct&gt;                 &lt;int&gt;   &lt;dbl&gt;
## 1 26-30                     3      30
## 2 31-35                     2      20
## 3 36-40                     3      30
## 4 41-45                     1      10
## 5 46-50                     1      10</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p><img src="Plotting_file_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="sorting-a-barplot-in-ascending-order" class="section level3">
<h3>Sorting a barplot in ascending order</h3>
<p>
Sometimes, like in the example above, the default order of labels along the x-axis works. Sometimes, however, you might want to arrange the bars in the plot in ascending or descending order.
</p>
<p>
The code below contains a function to plot the bars in ascending percentage order:
</p>
<pre><code>plot_column_asc &lt;- function(data, column, legend.label = quo(column)){
  data_name &lt;- deparse(substitute(data))
  column &lt;- enquo(column)
  data2 &lt;- data %&gt;% 
    group_by(!!column) %&gt;% 
    count() %&gt;% 
    ungroup() %&gt;% 
    mutate(percent=ceiling(100*(`n`/sum(`n`)))) %&gt;%
    mutate(!!column := as.factor(!!column)) %&gt;%
    
    
    ##The line below arranges the column in ascending order for plotting purposes. 
    mutate(!!column := forcats::fct_reorder(!!column, percent))
  
  print(data2)
  
  plot &lt;- ggplot(data2, aes(x = !!column, !!fill = column)) + geom_col(aes(y = percent)) + 
    theme_classic() + theme(legend.position = &quot;none&quot;) + xlab(legend.label) + ylab(&quot;Percent&quot;) + 
    geom_text(aes(label = paste0(percent, &quot;%&quot;), y = percent), vjust = -0.5) + scale_fill_grey()
    ##scale_fill_grey() was added to turn this graph into greyscale. Delete it if you want it in colour. 
  ggsave(paste0(data_name, legend.label, &quot;_bar_asc&quot;, &quot;.png&quot;, sep=&quot;&quot;), plot, device = &quot;png&quot;)
  plot
}</code></pre>
<p>
It’s largely similar to the code above. The chief exception is the line:
</p>
<pre><code>mutate(!!column := forcats::fct_reorder(!!column, percent))</code></pre>
<p>
This line requires that you have the forcats package installed. If you have tidyverse installed, then you should already have it. This package lets you work with factors. It is this line of code that sorts the bars in the barplot into ascending order.
</p>
<p>
Let’s look at the code in action
</p>
<p>
First, copy and paste the code for the function into a script and run the code to create the function <em>plot_column_asc</em>.
</p>
<p>
Next, call the function plot_column_asc. Specify the arguments: data, column and, optionally, legend.label.
<p>
In this example, I will work with the fake_data dataframe created above. I want to plot the column ‘X.2.What.Is.Your.Occupation.’, with the bars displayed in ascending order. I also want the main label along the x-axis to be something that is much easier to read: ‘Occupation’. This is what the code looks like, as well as the resulting output:
</p>
<pre class="r"><code>plot_column_asc(fake_data, column=X.2.What.Is.Your.Occupation., legend.label = &quot;Occupation&quot;)</code></pre>
<pre><code>## # A tibble: 5 x 3
##   X.2.What.Is.Your.Occupation.     n percent
##   &lt;fct&gt;                        &lt;int&gt;   &lt;dbl&gt;
## 1 Accountant                       2      20
## 2 Cleaner                          1      10
## 3 Doctor                           2      20
## 4 Magician                         4      40
## 5 Swamp Monster                    1      10</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<img src="Plotting_file_files/figure-html/unnamed-chunk-8-1.png" width="672" />
<p>
</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
